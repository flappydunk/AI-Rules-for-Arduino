//HS100 TP-Link power relay connection details
const char* host = "192.168.0.12"; //Fixed ip address of relay
const uint16_t port = 9999; 



// Use WiFiClient class to create TCP connections
WiFiClient client;

void Power_Relay_Action(boolean HS100) {
  // This will send a string to the server
  //Serial.print("connecting to ");
  //Serial.print(host);
  //Serial.print(':');
  //Serial.println(port);

  // Use WiFiClient class to create TCP connections
  WiFiClient client;
  if (!client.connect(host, port)) {
    Serial.println("HS100 connection failed");
    //delay(5000);
    return;
  }
  if (client.connected()) {
    //client.println("hello from ESP8266");
      if (HS100){
        //ON
         byte Send_HS100[] = {0x00, 0x00, 0x00, 0x2A, 0xD0, 0xF2, 0x81, 0xF8, 0x8B, 0xFF, 0x9A, 0xF7, 0xD5, 0xEF, 0x94, 0xB6, 0xC5, 0xA0, 0xD4, 0x8B, 0xF9, 0x9C, 0xF0, 0x91, 0xE8, 0xB7, 0xC4, 0xB0, 0xD1, 0xA5, 0xC0, 0xE2, 0xD8, 0xA3, 0x81, 0xF2, 0x86, 0xE7, 0x93, 0xF6, 0xD4, 0xEE, 0xDF, 0xA2, 0xDF, 0xA2};    //
         client.write(Send_HS100, 46);
         //Serial.println("HS100 ON");
      }
      else{
        //OFF
        byte Send_HS100[] = {0x00, 0x00, 0x00, 0x2A, 0xD0, 0xF2, 0x81, 0xF8, 0x8B, 0xFF, 0x9A, 0xF7, 0xD5, 0xEF, 0x94, 0xB6, 0xC5, 0xA0, 0xD4, 0x8B, 0xF9, 0x9C, 0xF0, 0x91, 0xE8, 0xB7, 0xC4, 0xB0, 0xD1, 0xA5, 0xC0, 0xE2, 0xD8, 0xA3, 0x81, 0xF2, 0x86, 0xE7, 0x93, 0xF6, 0xD4, 0xEE, 0xDE, 0xA3, 0xDE, 0xA3};    //
        client.write(Send_HS100, 46);
        //Serial.println("HS100 OFF");
      } 

      // Close the connection
      //Serial.println();
      //Serial.println("closing connection");
      client.stop();
  }
}
